[node]
# Dual Stack (sends/receives both IPv4 and IPv6)
listen = "[::]:9000"
# Virtual MTU of the TAP interface
mtu = 1420
# Name of the interface to create
# tap_name = "laminar0"
# TLS Identity Private Key (Base64 encoded DER)
private_key = "MFECAQEwBQYDK2VwBCIEIO5kIs8rIJb03hWoqovuvTbriNzrSJWiF4ZouYB4bgjWgSEADP/bL4no1OaRfpJX/7yJtnM2yfOs8nvGQ/lB8S8I4co="

# Scaling: Number of parallel streams per connection (0 = Use Datagrams/Unreliable)
streams = 4

# Load Balancing Strategy: water_filling (default), random, sticky
bonding_mode = "water_filling"

# L2 Bridging Config (Optional)
# Uncomment to enable bridging with a physical interface
#[node.bridge]
#name = "br0"
#external_interface = "eth1"

# Network Identity
mac_address = "02:00:00:00:00:01"
dhcp = false
addresses = [
    { address = "10.100.0.1/24", gateway = "10.100.0.254" },
    { address = "fd00::1/64", gateway = "fd00::ff" },
]
dns = ["8.8.8.8", "1.1.1.1"]

# Lifecycle Hooks
up_script = """
# Setup addresses
for addr in $LAMINAR_ADDRS; do
    if [ "$(uname)" = "Darwin" ]; then
        # macOS ifconfig workaround (strips CIDR, needs IP twice)
        IP=$(echo $addr | cut -d/ -f1)
        if echo $addr | grep -q ":"; then
            ifconfig $LAMINAR_IFACE inet6 $IP $IP prefixlen 64 up
        else
            ifconfig $LAMINAR_IFACE $IP $IP up
        fi
    else
        ip addr add $addr dev $LAMINAR_IFACE || true
        ip link set dev $LAMINAR_IFACE up
    fi
done

# Setup gateways
for gw in $LAMINAR_GATEWAYS; do
    if [ "$(uname)" = "Darwin" ]; then
        if echo $gw | grep -q ":"; then
            route add -inet6 default $gw || true
        else
            route add default $gw || true
        fi
    else
        ip route add default via $gw || true
    fi
done
"""
down_script = "echo 'Shutting down $LAMINAR_IFACE'"

[[peers]]
name = "site-b"
# Base64 encoded public key of the peer
public_key = "PASTE_PEER_PUBLIC_KEY_HERE"
# List of physical endpoints for this peer
endpoints = ["192.168.1.5:9000"]
